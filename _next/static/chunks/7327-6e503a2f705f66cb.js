"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7327],{15886:function(e,t,n){n.d(t,{z:function(){return AudioPlayer}});var l=n(97458),s=n(52983),a=n(14830),r=n(33569),i=n(33168),o=n(74550),c=n(70433),d=n(50606),u=n(51129),p=n(55544),m=n(18854);let AudioPlayer=e=>{var t;let{text:n,messageId:h,alwaysUseCredits:x}=e,{config:g}=(0,i.ZR)(),f=(0,c.jp)(),[v,b]=(0,o.KO)(u.e.playbackRateAtom),j=u.e.useIsPlaying(h),y=u.e.useIsLoading(h),w=(0,m.useRouter)(),N=(0,p.useTranslations)(),k={messageId:h,config:g,licenseKey:null===(t=f.data)||void 0===t?void 0:t.licenseKey,text:n,alwaysUseCredits:!!x,router:w,t:N};return(0,s.useEffect)(()=>{u.e.stop()},[n]),(0,l.jsxs)("div",{className:(0,a.cn)("flex items-center text-sm h-6 gap-1"),children:[y?(0,l.jsx)(r.$,{}):(0,l.jsx)(d.z,{variant:"message_action",className:(0,a.cn)("flex items-center gap-1"),type:"button",onClick:async e=>{u.e.playPause(k)},children:(0,l.jsx)("span",{className:(0,a.cn)(j||y?"i-lucide-pause-circle":"i-lucide-volume-2")})}),(0,l.jsxs)(d.z,{type:"button",variant:"message_action",left:(0,l.jsx)("span",{className:"i-mdi-play-speed mr-1"}),onClick:()=>{b(e=>1===e?1.5:1.5===e?2:2===e?.5:.5===e?1:e)},children:[v,"x"]})]})}},39114:function(e,t,n){n.d(t,{v:function(){return ChatPluginsDialog}});var l=n(97458),s=n(52983),a=n(66706),r=n(33168),i=n(19106),o=n(50606),c=n(98994),d=n(72686),u=n(60863),p=n(89691),m=n(11092),h=n(14830);let x=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,l.jsx)(m.fC,{ref:t,className:(0,h.cn)("peer h-4 w-4 shrink-0 rounded-md border border-zinc-500 ring-offset-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-blue-500 dark:data-[state=checked]:bg-blue-800 data-[state=checked]:border-blue-500 dark:data-[state=checked]:border-blue-700 data-[state=checked]:text-white",n),...s,children:(0,l.jsx)(m.z$,{className:(0,h.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)("span",{className:"h-4 w-4 i-tabler-check"})})})});x.displayName=m.fC.displayName;var g=n(61383),f=n(56030),v=n(18854);let PluginConfigForm=e=>{let{configSchema:t,pluginName:n,updatePluginConfig:s,installedPlugin:a}=e,{register:r,handleSubmit:i,formState:m}=(0,u.cI)({defaultValues:a.config});return(0,l.jsxs)("form",{className:"grid gap-2 border-t px-3 py-3",onSubmit:i(e=>{s(n,e),p.Am.success("Saved!")}),children:[Object.keys(t.properties).map(e=>{var n;let s=t.properties[e];return(0,l.jsx)("div",{children:(0,l.jsx)(c.o,{label:s.title||e,children:(0,l.jsx)(d.I,{isPassword:s.isPassword,className:"",required:null===(n=t.required)||void 0===n?void 0:n.includes(e),...r(e)})})},e)}),(0,l.jsx)("div",{children:(0,l.jsx)(o.z,{type:"submit",isDisabled:!m.isDirty,children:"Save"})})]})},ChatPluginsDialog=()=>{var e;let t=(0,g.LC)(),{config:n}=(0,r.ZR)(),c=(0,r.EK)(),[d,u]=(0,s.useState)("installed"),p=(0,v.useRouter)(),updatePluginConfig=(e,t)=>{var l;let s=null===(l=n.installedPlugins)||void 0===l?void 0:l.map(n=>n.name_for_model===e?{...n,config:t}:n);a.h.config.update({installedPlugins:s})},installOrUninstall=(e,t)=>{let l=n.installedPlugins,s=t?null==l?void 0:l.filter(t=>t.name_for_model!==e):[...l||[],{name_for_model:e,installedAt:new Date().toISOString(),enabled:!0}];t||u("installed"),a.h.config.update({installedPlugins:s})},deleteCustomPlugin=e=>{var t;let l=null===(t=n.customPlugins)||void 0===t?void 0:t.filter(t=>t.name_for_model!==e);a.h.config.update({customPlugins:l})},m=[{id:"installed",title:"Installed",children:(0,l.jsxs)("div",{children:[(!n.installedPlugins||0===n.installedPlugins.length)&&(0,l.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-5 text-center rounded-xl",children:"No installed plugins."}),(0,l.jsx)("div",{className:"grid gap-2",children:null===(e=n.installedPlugins)||void 0===e?void 0:e.sort((e,t)=>new Date(e.installedAt)<new Date(t.installedAt)?1:-1).map(e=>{let t=c.find(t=>t.name_for_model===e.name_for_model);return t?(0,l.jsxs)("div",{className:"border rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:t.name_for_human}),(0,l.jsx)("div",{className:"text-zinc-500 text-sm",children:t.description_for_human})]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[t.doc_url&&(0,l.jsx)("a",{href:t.doc_url,target:"_blank",rel:"noopener",className:(0,h.cn)("inline-flex items-center text-lg"),children:(0,l.jsx)("span",{className:"i-tabler-help"})}),(0,l.jsx)(o.z,{type:"button",variantColor:"red",onClick:()=>{installOrUninstall(t.name_for_model,!0)},children:"Uninstall"}),(0,l.jsx)(x,{className:"h-6 w-6",checked:e.enabled,onCheckedChange:()=>{let t=n.installedPlugins,l=null==t?void 0:t.map(t=>t.name_for_model===e.name_for_model?{...t,enabled:!t.enabled}:t);a.h.config.update({installedPlugins:l})}})]})]}),e.enabled&&t.config_schema&&(0,l.jsx)(PluginConfigForm,{pluginName:t.name_for_model,configSchema:t.config_schema,installedPlugin:e,updatePluginConfig:updatePluginConfig})]},e.name_for_model):null})})]})},{id:"all",title:"All plugins",children:(0,l.jsx)("div",{children:(0,l.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:c.map(e=>{var t;let s=null===(t=n.installedPlugins)||void 0===t?void 0:t.some(t=>t.name_for_model===e.name_for_model);return(0,l.jsx)("div",{className:"border rounded-lg",children:(0,l.jsxs)("div",{className:"p-3 grid gap-2",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"select-none font-medium",children:e.name_for_human})}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(o.z,{type:"button",variantColor:s?"red":"default",onClick:()=>{installOrUninstall(e.name_for_model,s)},children:s?"Uninstall":"Install"}),e.ai_plugin_json_url&&(0,l.jsx)(o.z,{type:"button",variantColor:"red",onClick:()=>deleteCustomPlugin(e.name_for_model),children:(0,l.jsx)("span",{className:"i-tabler-trash"})})]}),(0,l.jsx)("div",{className:"text-zinc-500 text-sm",children:e.description_for_human})]})},e.name_for_model)})})})}];return(0,l.jsx)(f.Q,{title:"Chat Plugins",label:"Chat plugins",isOpen:"#chat_plugins"===t,closeModal:()=>{(0,g.gp)(p,"")},children:(0,l.jsxs)(i.mQ,{value:d,onValueChange:e=>{u(e)},children:[(0,l.jsx)(i.dr,{children:m.map(e=>(0,l.jsx)(i.SP,{value:e.id,children:e.title},e.id))}),m.map(e=>(0,l.jsx)(i.nU,{value:e.id,children:e.children},e.id))]})})}},54797:function(e,t,n){n.d(t,{F:function(){return ChatSettingsDialog}});var l=n(97458),s=n(66706),a=n(21654),r=n(18854),i=n(98994),o=n(72686),c=n(91601),d=n(52983),u=n(50606),p=n(98846),m=n(33168),h=n(88161),x=n(14830);let g=d.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,l.jsxs)(h.fC,{ref:t,className:(0,x.cn)("relative flex w-full touch-none select-none items-center",n),...s,children:[(0,l.jsx)(h.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-zinc-200 dark:bg-zinc-800",children:(0,l.jsx)(h.e6,{className:"absolute h-full bg-zinc-900  dark:bg-zinc-400"})}),(0,l.jsx)(h.bU,{className:"block h-5 w-5 rounded-full border-2 border-zinc-900 bg-white transition-colors focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-zinc-100 dark:bg-zinc-400 dark:focus:ring-zinc-400 dark:focus:ring-offset-zinc-900"})]})});g.displayName=h.fC.displayName;var f=n(92891),v=n(89691),b=n(19106),j=n(37855);let y=(0,j.tv)({base:"inline-flex items-center text-sm  border p-2 py-1 rounded-lg gap-1",variants:{variant:{default:"text-zinc-700 bg-zinc-50 dark:bg-zinc-800 dark:text-white",info:"text-blue-500 border-blue-200 bg-blue-50/50 dark:bg-blue-900 dark:text-white dark:border-blue-700"}},defaultVariants:{variant:"default"}}),Alert=e=>{let{children:t,variant:n,className:s}=e;return(0,l.jsxs)("div",{className:y({variant:n,className:s}),children:[(0,l.jsx)("span",{className:"i-ion-ios-information-circle-outline text-lg shrink-0"}),t]})};var w=n(55544),N=n(60863);let CustomModelForm=e=>{var t,n,a,r;let{cancel:c,customModelId:p,className:h,onSaveModelName:g}=e,{config:f}=(0,m.ZR)(),{register:v,formState:b,handleSubmit:j,control:y,reset:k,setError:_,setValue:A}=(0,N.cI)({defaultValues:{name:"",url:"",model:"",headers:[],stream:!1,contextLimit:4096}}),C=(0,w.useTranslations)(),z=(0,N.Dq)({control:y,name:"headers"}),R=j(async e=>{let t=f.customModels||[],n=t.find(t=>t.name===e.name);if(p){if(n&&n.id!==p){_("name",{message:"name already used"});return}await s.h.config.update({customModels:t.map(t=>t.id===p?{...t,...e}:t)}),null==g||g(e.name)}else{if(n){_("name",{message:"name already used"});return}let l=crypto.randomUUID();await s.h.config.update({customModels:[...t,{id:l,...e}]}),null==g||g(e.name)}k(),c()});return(0,d.useEffect)(()=>{var e;if(!p)return;let t=null===(e=f.customModels)||void 0===e?void 0:e.find(e=>e.id===p);t&&(A("model",t.model),A("name",t.name),A("url",t.url),A("headers",t.headers),A("stream",!!t.stream),t.contextLimit&&A("contextLimit",t.contextLimit))},[p,f]),(0,l.jsx)("div",{className:(0,x.cn)("bg-zinc-200/50 dark:bg-zinc-800/50 border-t border-b animate-in slide-in-from-top-2",h),children:(0,l.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,l.jsxs)("div",{className:"font-semibold border-b px-3 py-3 flex items-center gap-2",children:[(0,l.jsx)("span",{children:C(p?"custom_model.edit_custom_model":"custom_model.add_custom_model")}),(0,l.jsx)("a",{className:"inline-flex",target:"_blank",href:"https://docs.chatkit.app/custom-model.html",children:(0,l.jsx)("span",{className:"i-tabler-help"})})]}),(0,l.jsxs)("div",{className:"grid gap-3 p-3",children:[(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,l.jsx)(i.o,{label:C("custom_model.name"),error:null===(t=b.errors.name)||void 0===t?void 0:t.message,children:(0,l.jsx)(o.I,{type:"text",...v("name",{required:{value:!0,message:"Required"}})})}),(0,l.jsx)(i.o,{label:C("custom_model.model"),error:null===(n=b.errors.model)||void 0===n?void 0:n.message,children:(0,l.jsx)(o.I,{type:"text",...v("model",{required:{value:!0,message:"Required"}})})})]}),(0,l.jsx)(i.o,{label:"URL",desc:C("custom_model.url_desc"),error:null===(a=b.errors.url)||void 0===a?void 0:a.message,children:(0,l.jsx)(o.I,{type:"url",...v("url",{required:{value:!0,message:"Required"},pattern:{value:/^https?\:\/\//,message:"Must be a URL"}})})}),(0,l.jsx)(i.o,{label:C("custom_model.context_limit"),desc:C("custom_model.context_limit_desc"),error:null===(r=b.errors.contextLimit)||void 0===r?void 0:r.message,children:(0,l.jsx)(o.I,{type:"number",step:1,min:2048,...v("contextLimit",{required:{value:!0,message:"Required"}})})}),(0,l.jsx)(i.o,{label:"Stream",children:(0,l.jsxs)("label",{className:"inline-flex items-center gap-1",children:[(0,l.jsx)("input",{type:"checkbox",...v("stream")})," ",C("custom_model.stream_desc")]})}),(0,l.jsx)(i.o,{label:"Headers",right:(0,l.jsxs)("button",{type:"button",className:"inline-flex items-center text-xs",onClick:()=>{z.append({key:"",value:""})},children:[(0,l.jsx)("span",{className:"i-tabler-plus mr-1"}),C("custom_model.new_header")]}),children:(0,l.jsx)("div",{className:"grid gap-2",children:z.fields.map((e,t)=>{var n,s,a,r,c,d;return(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)(i.o,{error:null===(a=b.errors.headers)||void 0===a?void 0:null===(s=a[t])||void 0===s?void 0:null===(n=s.key)||void 0===n?void 0:n.message,children:(0,l.jsx)(o.I,{placeholder:"key",...v("headers.".concat(t,".key"),{required:{value:!0,message:"Required"}})})}),(0,l.jsx)(i.o,{error:null===(d=b.errors.headers)||void 0===d?void 0:null===(c=d[t])||void 0===c?void 0:null===(r=c.value)||void 0===r?void 0:r.message,children:(0,l.jsx)(o.I,{placeholder:"value",...v("headers.".concat(t,".value"),{required:{value:!0,message:"Required"}})})}),(0,l.jsx)(u.z,{type:"button",variant:"primary",variantColor:"red",onClick:()=>z.remove(t),children:(0,l.jsx)("span",{className:"text-xl i-mingcute-delete-2-line"})})]},e.id)})})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1 border-t px-3 py-3",children:[(0,l.jsx)(u.z,{type:"button",onClick:()=>{R()},children:C("app.save")}),(0,l.jsx)(u.z,{type:"button",onClick:c,variant:"ghost",children:C("app.cancel")})]})]})})};var k=n(70433),_=n(49739),A=n(98359),C=n(61383),z=n(56030);let ChatSettingsForm=e=>{var t,n,h,x,b,j,y,N,C;let{chatId:z,isDefaultSettings:R,currentChat:S}=e,{config:D}=(0,m.ZR)(),F=(0,k.jp)(),M=(0,w.useTranslations)(),P=(0,r.useRouter)(),[E,T]=(0,d.useState)(!1),updateChat=async e=>{R?await s.h.config.update({defaultChatSettings:{...L,...e}}):await (0,s.D0)(P,z,{...L,...e})},I=(0,A.y1)(updateChat,200),U=(0,d.useRef)(null),handleUploadFile=async e=>{let t=e.target.files;if(!t||0===t.length)return;let n=t[0];await v.Am.promise((0,f.c)(n,{name:n.name,mime:n.type,chatId:z}),{loading:"Uploading file...",error:e=>(console.error(e),"Error uploading file"),success:e=>((0,s.D0)(P,z,{context:{sources:[...V.map(e=>({type:"url",url:e})),{type:"url",url:e.url}]}}),"File uploaded")})},L=R?D.defaultChatSettings:S||D.defaultChatSettings,V=(null==L?void 0:null===(t=L.context)||void 0===t?void 0:t.url)?[]:(null==L?void 0:null===(n=L.context)||void 0===n?void 0:n.sources)?L.context.sources.map(e=>e.url):[],K=(null==L?void 0:null===(h=L.model)||void 0===h?void 0:h.startsWith("custom:"))?null===(x=D.customModels)||void 0===x?void 0:x.find(e=>{var t;return e.name===(null==L?void 0:null===(t=L.model)||void 0===t?void 0:t.replace("custom:",""))}):void 0;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"text-zinc-500 -mt-3 px-3 text-sm md:text-center md:min-h-[20px]",children:R&&M("chat_settings.default_settings_desc")}),(0,l.jsxs)("div",{className:"flex flex-col gap-5 p-3 py-5",children:[(0,l.jsxs)(i.o,{horizontal:!0,label:M("chat_settings.model.label"),right:(0,l.jsxs)("button",{type:"button",onClick:()=>T(e=>"add"!==e&&"add"),className:"inline-flex items-center text-xs gap-0.5 text-zinc-400 hover:text-black dark:hover:text-white",children:[(0,l.jsx)("span",{className:"i-tabler-plus"}),M("custom_model.custom_model")]}),children:[(0,l.jsx)(_.q,{model:(null==L?void 0:L.model)||"gpt-3.5-turbo",onChange:e=>{e&&updateChat({model:e})}}),(null==L?void 0:L.model)==="gpt-4"&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(Alert,{variant:"info",children:(0,l.jsx)("p",{children:M.rich("chat_settings.model.gpt4_warning",{link_gpt4:()=>(0,l.jsx)("a",{href:"https://openai.com/waitlist/gpt-4-api",target:"_blank",className:"underline",children:"GPT-4 API"})})})})}),(null==L?void 0:L.model)==="gpt-4-32k"&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(Alert,{variant:"info",children:(0,l.jsx)("p",{children:M("chat_settings.model.gpt4_32k_warning")})})}),(null==L?void 0:null===(b=L.model)||void 0===b?void 0:b.startsWith("custom:"))&&K&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>T(e=>"edit"!==e&&"edit"),className:"inline-flex items-center text-xs gap-0.5 text-zinc-400 hover:text-black dark:hover:text-white",children:[(0,l.jsx)("span",{className:"i-tabler-pencil"}),M("custom_model.edit_model")]}),(0,l.jsxs)("button",{type:"button",onClick:()=>{let e=D.customModels||[];s.h.config.update({customModels:e.filter(e=>{var t;return e.name!==(null==L?void 0:null===(t=L.model)||void 0===t?void 0:t.replace("custom:",""))})})},className:"inline-flex items-center text-xs gap-0.5 text-red-500 hover:text-red-400 dark:hover:text-red-400",children:[(0,l.jsx)("span",{className:"i-tabler-trash"}),M("custom_model.delete_model")]})]})]}),"add"===E&&(0,l.jsx)(CustomModelForm,{className:"-mx-3",cancel:()=>T(!1),onSaveModelName:e=>{updateChat({model:"custom:".concat(e)})}}),K&&E&&(0,l.jsx)(CustomModelForm,{className:"-mx-3",customModelId:K.id,cancel:()=>T(!1),onSaveModelName:e=>{updateChat({model:"custom:".concat(e)})}}),(0,l.jsx)(i.o,{horizontal:!0,label:M("chat_settings.initialSystemMessage"),children:(0,l.jsx)(o.I,{defaultValue:(null==L?void 0:L.initialSystemMessage)||"",onChange:e=>{updateChat({initialSystemMessage:e.target.value})},className:"p-2 scroll-p-2 h-auto resize-none max-h-[300px]",asChild:!0,placeholder:"You are a helpful assistant.",children:(0,l.jsx)(c.Z,{rows:3})})}),(0,l.jsx)(i.o,{horizontal:!0,label:M("app.credits"),children:(0,l.jsxs)("label",{className:"flex items-center gap-1",children:[(0,l.jsx)("input",{type:"checkbox",defaultChecked:null==L?void 0:L.alwaysUseCredits,onChange:e=>{updateChat({alwaysUseCredits:e.target.checked})}}),(0,l.jsx)("span",{children:M("app.always_use_credits")})]})}),!(null==L?void 0:null===(j=L.model)||void 0===j?void 0:j.includes("gemini"))&&(0,l.jsx)(i.o,{horizontal:!0,label:M("chat_settings.lastNMessages.label"),desc:M("chat_settings.lastNMessages.desc"),children:M.rich("chat_settings.lastNMessages.content",{select:()=>{var e;return(0,l.jsx)(a.p,{defaultValue:null!==(e=null==L?void 0:L.includeLastNMessages)&&void 0!==e?e:s.OM,onChange:e=>{updateChat({includeLastNMessages:Number(e.target.value)})},children:[1,3,5,10,15,20,25,50,100].map(e=>(0,l.jsx)("option",{value:e,children:e},e))})}})}),(null==L?void 0:L.model)!=="claude"&&(0,l.jsx)(i.o,{horizontal:!0,label:M("chat_settings.maxResponseTokens.label"),desc:M.rich("chat_settings.maxResponseTokens.desc",{link_token_counter:e=>(0,l.jsx)("a",{href:"https://platform.openai.com/tokenizer",target:"_blank",rel:"nofollow noopener",className:"underline",children:e})}),children:(0,l.jsx)(o.I,{defaultValue:null!==(y=null==L?void 0:L.maxResponseTokens)&&void 0!==y?y:1e3,onChange:e=>I({maxResponseTokens:Number(e.target.value)}),type:"number",step:1,min:1,max:4086})}),(0,l.jsxs)(i.o,{horizontal:!0,label:M("chat_settings.context.label"),desc:M("chat_settings.context.desc"),children:[V.length>0&&(0,l.jsx)("div",{className:"flex flex-col gap-2 mb-2",children:V.map((e,t)=>(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(o.I,{type:"url",required:!0,className:"",placeholder:M("chat_settings.context.url_placeholder"),defaultValue:e,onChange:e=>{updateChat({context:{sources:V.map((n,l)=>l===t?{type:"url",url:e.target.value}:{type:"url",url:n})}})}}),(0,l.jsx)(u.z,{type:"button",left:(0,l.jsx)("span",{className:"i-tabler-trash mr-1"}),className:"h-10 bg-red-100 border-0 text-red-500 font-medium ring-red-300 active:bg-red-200",onClick:()=>{updateChat({context:{sources:V.filter((e,n)=>n!==t).map(e=>({type:"url",url:e}))}})},children:M("app.remove")})]},t))}),(0,l.jsxs)("div",{className:"space-x-1",children:[(0,l.jsx)(u.z,{type:"button",variant:"default",onClick:()=>{if(V.length>0&&!F.data){(0,p._)(M("chat_settings.context.upgrade_to_add_more_urls"));return}updateChat({context:{sources:[...V.map(e=>({type:"url",url:e})),{type:"url",url:""}]}})},children:M("chat_settings.context.add_url")}),(0,l.jsx)("input",{type:"file",className:"hidden",ref:U,accept:"text/*,.pdf",onChange:handleUploadFile}),(0,l.jsx)(u.z,{type:"button",variant:"default",onClick:()=>{var e;if(V.length>0&&!F.data){(0,p._)(M("chat_settings.context.upgrade_to_add_more_urls"));return}null===(e=U.current)||void 0===e||e.click()},children:M("chat_settings.context.upload_file")})]}),(0,l.jsx)("div",{className:"text-sm mt-1 text-zinc-500",children:M("chat_settings.context.uploaded_file_desc")})]}),(null==L?void 0:L.model)!=="claude"&&(0,l.jsxs)(i.o,{horizontal:!0,label:"".concat(M("chat_settings.temperature.label"),": ").concat(null!==(N=null==L?void 0:L.temperature)&&void 0!==N?N:.5),children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs mb-2 text-zinc-500",children:[(0,l.jsx)("span",{children:M("chat_settings.temperature.precise")}),(0,l.jsx)("span",{children:M("chat_settings.temperature.balanced")}),(0,l.jsx)("span",{children:M("chat_settings.temperature.creative")})]}),(0,l.jsx)(g,{defaultValue:[null!==(C=null==L?void 0:L.temperature)&&void 0!==C?C:.5],onValueChange:e=>{I({temperature:e[0]})},min:0,max:1,step:.1}),(0,l.jsx)("p",{className:"text-zinc-500 text-xs mt-3",children:M("chat_settings.temperature.desc")})]})]})]})},ChatSettingsTabs=e=>{let{chatId:t,currentChat:n}=e,s=(0,w.useTranslations)(),a=[{label:s("chat_settings.current_chat"),id:"current_chat",content:(0,l.jsx)(ChatSettingsForm,{chatId:t,currentChat:n})},{label:s("chat_settings.default_settings"),id:"default_settings",content:(0,l.jsx)(ChatSettingsForm,{chatId:t,currentChat:n,isDefaultSettings:!0})}];return(0,l.jsxs)(b.mQ,{defaultValue:"current_chat",children:[(0,l.jsx)("div",{className:"p-3 flex md:justify-center sticky top-0 bottom-0 z-10",children:(0,l.jsx)(b.dr,{className:"",children:a.map(e=>(0,l.jsx)(b.SP,{value:e.id,children:e.label},e.id))})}),a.map(e=>(0,l.jsx)(b.nU,{value:e.id,children:e.content},e.id))]})},ChatSettingsDialog=e=>{let{chatId:t,currentChat:n}=e,s=(0,C.LC)(),a=(0,r.useRouter)();return(0,l.jsx)(z.Q,{isSettings:!0,label:"Chat settings",isOpen:"#chat_settings"===s,closeModal:()=>{(0,C.gp)(a,"")},children:(0,l.jsx)(ChatSettingsTabs,{chatId:t,currentChat:n})})}},21734:function(e,t,n){n.d(t,{Q:function(){return FollowUpQuestions}});var l=n(97458),s=n(66706),a=n(33569),r=n(52983),i=n(55544),o=n(6604),c=n(33168),d=n(1295);let FollowUpQuestions=e=>{let{isLoading:t,questions:n,send:u,resetQuestions:p}=e,m=(0,i.useTranslations)(),{config:h}=(0,c.ZR)(),[x,g]=(0,r.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[t&&(0,l.jsxs)("div",{className:"text-zinc-500 flex gap-2 items-center text-xs justify-center",children:[(0,l.jsx)(a.$,{}),(0,l.jsx)("span",{children:m("app.followup_questions.loading")})]}),n&&n.length>0&&(0,l.jsxs)("div",{className:"max-w-[80%] mx-auto",children:[(0,l.jsx)("div",{className:"flex justify-center text-sm font-medium items-center gap-2",children:(0,l.jsx)("span",{children:m("app.followup_questions.label")})}),!1!==h.generateFollowupQuestions&&(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)(d.hg,{isOpen:x,onOpenChange:g,children:[(0,l.jsx)(d.zx,{type:"button",className:"text-zinc-400 text-xs hover:text-black dark:hover:text-zinc-200",children:m("app.followup_questions.disable")}),(0,l.jsx)(o.Q,{title:m("disable_followups.title"),desc:m("disable_followups.desc"),onConfirm:async()=>{g(!1),p(),await s.h.config.update({generateFollowupQuestions:!1})}})]})}),(0,l.jsx)("div",{className:"flex flex-col gap-2 justify-center items-center mt-4",children:n.map((e,t)=>(0,l.jsx)("button",{type:"button",className:"rounded-full border max-w-full shadow-xs py-1 flex items-center justify-center text-center px-3 text-xs focus:bg-zinc-100 hover:bg-zinc-50 dark:hover:bg-zinc-700 dark:focus:bg-zinc-800",onClick:()=>{u({input:e})},children:(0,l.jsx)("span",{className:"line-clamp-2",children:e})},t))})]})]})}},33597:function(e,t,n){n.d(t,{A:function(){return HomeFeatures}});var l=n(97458);let s=["No log-in required","Use your own API key or ChatKit credits","Prompt templates","Chat bookmarks","Text-to-speech and Voice input","Web search & fetch URLs","One-time payment","New features every week"],HomeFeatures=()=>(0,l.jsx)("div",{className:"text-sm mx-auto w-full md:max-w-[80%]",children:(0,l.jsx)("div",{className:"grid md:grid-cols-2 gap-1",children:s.map((e,t)=>(0,l.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,l.jsx)("span",{className:"i-tabler-circle-check-filled text-green-500 text-base"}),(0,l.jsx)("span",{children:e})]},t))})})},79696:function(e,t,n){n.d(t,{z:function(){return ModelAvatar}});var l=n(97458),s=n(42159),a=n.n(s),r=n(86109),i={src:"/_next/static/media/mistral-logo.67763385.png",height:208,width:208,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAASFBMVEVMaXH/AAf/HgX/9QD/dQCfKQDZTgAtEgDEAQY0GwChhwD/1gCiEQNQMwDIbgDeugD/ugDWVQDlrgDlXADdFgTKlwD8kAD8lQCm7F4PAAAAF3RSTlMAIWMbWUPqYUkfRFnaRtZHQ9D00tv20sNCVEEAAAAJcEhZcwAACxMAAAsTAQCanBgAAAA2SURBVHicY2CAA05+BgYuZgYGBnYhAV5RbhBDXIxPnAXEYBMUZgMzRFhZeZhAijkYGDgYEZoBNXkBYZYR8aAAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},o={src:"/_next/static/media/openhermes-logo.d0107c8b.png",height:566,width:566,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAdVBMVEXUzc6xq7L37ulKVmOPhJGslZTi0spxZ3KWlJzZwr++mZNMR1R6iJj7+ffKvLxnXGm2sro8Q1SagonRr6mmo66vl5lPYG9NanZjbn+Mf4SCb3favrWUj5AuOk9rf4xfbHqxo6SOd39bYW3g3+DVvrvo19HAvcGmt444AAAACXBIWXMAAAsTAAALEwEAmpwYAAAARklEQVR4nAXBhQGAMAADsM6YM8Pd/z+RBDHSqqJo8CmzKCEI7tPum5WAf66U1tbjeDPno64RSsnczBN0LRkLRANu6Hqp3A+JnQPAGiC5wwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},c={src:"/_next/static/media/cohere-avatar.2096e5db.png",height:500,width:500,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEVMaXHjl/EuVUPviLrnf4X7d1o6WU03WE3RjuQQOCH/f1+ZZ0//eVJeZGe6hs4yVkffkvA5XVDsof+PDLPwAAAAEXRSTlMAJeaVGl1rTVsJEJf1jLKTsVoZaRgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAA0SURBVHicRYjbDgAQDMUONnNn/v9jZRHRlzYFPhKjZLOqqtzw006pfSwHgFvYOwEgpmR+HDHMAVdmAEhNAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},d=n(14830),u=n(17129);let ModelAvatar=e=>{let{model:t,className:n,size:s,rounded:p}=e,m=(0,u.d)(),h="number"==typeof s?s:m?26:"sm"===s?26:40,x="string"==typeof p?p:!1===p?"":"rounded-xl",g="claude"===t||"openrouter-anthropic/claude-2"===t||"openrouter-anthropic/claude-instant-v1"===t,f=t&&(t.includes("mistral")||t.includes("mixtral")),v="pplx-openhermes-2.5-mistral-7b"===t,b="cohere"===t;return g||f||v||b?(0,l.jsx)("div",{className:(0,d.cn)("shrink-0"),children:(0,l.jsx)(a(),{src:b?c:v?o:f?i:r.Z,width:h,height:h,alt:t,className:(0,d.cn)("shrink-0 inline-block","bg-zinc-200 dark:bg-zinc-800",x,n)})}):(0,l.jsx)("div",{className:(0,d.cn)("inline-flex items-center justify-center text-white shrink-0","gpt-4"===t||(null==t?void 0:t.startsWith("gpt-4-"))?"bg-zinc-900":"openrouter-google/palm-2-chat-bison"===t?"bg-zinc-200 dark:bg-zinc-800":(null==t?void 0:t.includes("llama"))?"bg-zinc-200 dark:bg-zinc-800":(null==t?void 0:t.startsWith("pplx-"))?"bg-zinc-800":(null==t?void 0:t.includes("gemini"))?"bg-sky-300 dark:bg-sky-800":(null==t?void 0:t.startsWith("openrouter-"))?"bg-zinc-400 dark:bg-zinc-700":""===t?"bg-zinc-400 dark:bg-zinc-800":"bg-teal-500",("custom"===t||(null==t?void 0:t.startsWith("custom:")))&&"bg-pink-500",x,n),style:{width:"".concat(h,"px"),height:"".concat(h,"px"),fontSize:"".concat(h/1.5,"px")},children:(null==t?void 0:t.includes("llama"))?(0,l.jsx)("span",{children:"\uD83E\uDD99"}):"openrouter-google/palm-2-chat-bison"===t?(0,l.jsx)(PaLM,{}):(0,l.jsx)("span",{className:(0,d.cn)(""===t?"i-lucide-user-2":(null==t?void 0:t.includes("gemini"))?"i-simple-icons-google":(null==t?void 0:t.startsWith("pplx-"))?"i-arcticons-perplexity":"custom"===t||(null==t?void 0:t.startsWith("custom:"))?"i-mingcute-android-2-fill":(null==t?void 0:t.startsWith("openrouter-"))?"i-tabler-arrows-split-2":"i-simple-icons-openai")})})},PaLM=()=>(0,l.jsxs)("svg",{width:"1.2em",height:"1em",viewBox:"0 0 172 154",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("path",{d:"M86 153.92C92.63 153.92 98 148.55 98 141.92V37.92H74V141.92C74 148.55 79.37 153.92 86 153.92Z",fill:"#F9AB00"}),(0,l.jsx)("path",{d:"M133.81 75.87C120.87 62.94 101.54 60.32 86 68L137.37 119.37C139.49 121.49 143.14 120.65 144.04 117.8C148.56 103.49 145.15 87.22 133.81 75.87Z",fill:"#5BB974"}),(0,l.jsx)("path",{d:"M38.19 75.87C51.13 62.94 70.46 60.32 86 68L34.63 119.37C32.51 121.49 28.86 120.65 27.96 117.8C23.44 103.49 26.85 87.22 38.19 75.87Z",fill:"#129EAF"}),(0,l.jsx)("path",{d:"M130 36C109.56 36 92.21 49.4 86 68H167.24C170.57 68 172.79 64.48 171.28 61.51C163.56 46.36 147.98 36 130 36Z",fill:"#AF5CF7"}),(0,l.jsx)("path",{d:"M94.49 14.26C80.03 28.72 77.24 50.45 86 68L143.45 10.55C145.81 8.19 144.89 4.13 141.72 3.1C125.54 -2.15 107.2 1.55 94.49 14.26Z",fill:"#FF8BCB"}),(0,l.jsx)("path",{d:"M77.51 14.26C91.97 28.72 94.76 50.45 86 68L28.55 10.55C26.19 8.19 27.11 4.13 30.28 3.1C46.46 -2.15 64.8 1.55 77.51 14.26Z",fill:"#FA7B17"}),(0,l.jsx)("path",{d:"M42 36C62.44 36 79.79 49.4 86 68H4.76C1.43 68 -0.790003 64.48 0.719997 61.51C8.44 46.36 24.02 36 42 36Z",fill:"#4285F4"})]})},49739:function(e,t,n){n.d(t,{q:function(){return p}});var l=n(97458),s=n(79696),a=n(14830),r=n(40156),i=n(1295);let UISelect=e=>{let{items:t,value:n,defaultValue:s,onChange:r,placeholder:o,renderItem:c,triggerClass:d,contentClass:u}=e;return(0,l.jsxs)(i.Ph,{"aria-label":o,placeholder:o,selectedKey:n,defaultSelectedKey:s,onSelectionChange:e=>{r(e.toString())},children:[(0,l.jsxs)(i.zx,{type:"button",className:(0,a.cn)("inline-flex items-center gap-1 border h-8 rounded-lg px-2 outline-none transition-colors focus-visible:ring-2 ring-blue-500 focus-visible:border-blue-500 aria-expanded:bg-zinc-100 dark:aria-expanded:bg-zinc-800 text-sm",d),children:[(0,l.jsx)(i.ki,{children:e=>(0,l.jsx)("span",{children:e.selectedText||o})}),(0,l.jsx)("span",{className:"i-tabler-chevron-down","aria-hidden":!0})]}),(0,l.jsx)(i.J2,{className:(0,a.cn)("border z-[9999] rounded-lg outline-none overflow-hidden flex flex-col bg-white dark:bg-zinc-900",u),children:(0,l.jsx)("div",{className:"overflow-auto py-1 overscroll-none",children:(0,l.jsx)(i.wb,{className:"rounded-lg",items:t.map(e=>({id:e.value})),children:t.map(e=>(0,l.jsx)(i.m9,{id:e.value,textValue:e.label,className:"group px-2 flex justify-between outline-none py-1 items-center cursor-default hover:bg-zinc-100 dark:hover:bg-zinc-800 data-[focused]:bg-zinc-100 dark:data-[focused]:bg-zinc-800",children:t=>{let{isSelected:n}=t;return(0,l.jsxs)(l.Fragment,{children:[null==c?void 0:c(e),n&&(0,l.jsx)("span",{className:"i-tabler-check text-green-500"})]})}},e.value))})})})]})};var o=n(52983),c=n(55544),d=n(33168);let u=r.d.filter(e=>!e.removed).map(e=>({value:e.id,label:e.name})),p=(0,o.memo)(e=>{let{model:t,onChange:n,isStandalone:i,filterModels:p}=e,m=(0,c.useTranslations)(),{config:h}=(0,d.ZR)(),x=(0,o.useMemo)(()=>{var e;return[...(null===(e=h.customModels)||void 0===e?void 0:e.map(e=>({value:"custom:".concat(e.name),label:e.name})))||[],...u].filter(e=>!p||p(e.value))},[h.customModels,p]);return(0,l.jsx)(UISelect,{triggerClass:(0,a.cn)(i&&"border-0 hover:bg-zinc-100 dark:hover:bg-zinc-800"),placeholder:m("app.select_model"),items:x,value:t,renderItem:e=>{var t;let n=(0,r.x)(e.value),a=null!==(t=null==n?void 0:n.tokenLimit)&&void 0!==t?t:4096;return(0,l.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,l.jsx)(s.z,{model:e.value,size:"sm"}),(0,l.jsxs)("div",{className:"",children:[(0,l.jsx)("span",{className:"text-sm",children:e.label}),(0,l.jsxs)("div",{className:"text-zinc-400 dark:text-zinc-500 text-sm dark:group-focus:text-zinc-300",children:[a===1/0?"Unlimited":"".concat(Math.floor(a/1e3),"K")," ","Context"]})]})]})},onChange:n})})},68338:function(e,t,n){n.d(t,{A:function(){return NewPromptTemplate}});var l=n(97458),s=n(4124),a=n(52983),r=n(60863),i=n(91601),o=n(66706),c=n(50606),d=n(98994),u=n(72686),p=n(55544);let NewPromptTemplate=e=>{let{onClose:t,editingPrompt:n}=e,m=(0,p.useTranslations)(),{register:h,handleSubmit:x,setValue:g}=(0,r.cI)({defaultValues:{title:"",description:"",content:""}}),f=x(async e=>{var l,a;await o.h.prompt.set({id:null!==(l=null==n?void 0:n.id)&&void 0!==l?l:(0,s.x0)(),createdAt:null!==(a=null==n?void 0:n.createdAt)&&void 0!==a?a:new Date,title:e.title,description:e.description,content:e.content}),null==t||t()});return(0,a.useEffect)(()=>{n&&(g("title",n.title),g("description",n.description),g("content",n.content))},[n]),(0,l.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:f,children:[(0,l.jsx)(d.o,{label:m("app.prompt_form.title.label"),children:(0,l.jsx)(u.I,{...h("title"),required:!0,autoFocus:!0,placeholder:m("app.prompt_form.title.placeholder")})}),(0,l.jsx)(d.o,{label:m("app.prompt_form.description.label"),children:(0,l.jsx)(u.I,{...h("description"),placeholder:m("app.prompt_form.description.placeholder")})}),(0,l.jsx)(d.o,{label:m("app.prompt_form.prompt.label"),desc:m.rich("app.prompt_form.prompt.desc",{example:()=>"{{text}}",link_learn_more:e=>(0,l.jsx)("a",{href:"https://docs.chatkit.app/prompt-templates.html#placeholders",target:"_blank",className:"underline",children:e})}),children:(0,l.jsx)(u.I,{asChild:!0,className:"h-auto py-2 scroll-p-2 resize-none",children:(0,l.jsx)(i.Z,{placeholder:m("app.prompt_form.prompt.placeholder"),minRows:3,required:!0,...h("content")})})}),(0,l.jsx)("div",{children:(0,l.jsx)(c.z,{type:"submit",variant:"primary",children:m("app.save")})})]})}},77462:function(e,t,n){n.d(t,{Y:function(){return PromptVariablesDialog}});var l=n(97458),s=n(70781),a=n(56030),r=n(52983),i=n(91601),o=n(50606),c=n(98994),d=n(72686),u=n(21654);let PromptVariablesForm=e=>{let{variables:t,replaceInput:n,close:s}=e,[a,p]=(0,r.useState)(t.reduce((e,t)=>({...e,[t.name]:t.values&&t.values.length>0?t.values[0]:""}),{})),onSubmit=e=>{null==e||e.preventDefault(),n(a),s()};return(0,l.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:onSubmit,children:[t.map((e,t)=>(0,l.jsx)(c.o,{label:e.name,children:e.values&&e.values.length>0?(0,l.jsx)(u.p,{className:"w-full h-10",value:a[e.name]||"",onChange:t=>{p({...a,[e.name]:t.currentTarget.value})},children:e.values.map((e,t)=>(0,l.jsx)("option",{value:e,children:e},t))}):(0,l.jsx)(d.I,{asChild:!0,className:"h-auto py-2 resize-none",children:(0,l.jsx)(i.Z,{value:a[e.name]||"",minRows:1,required:!0,autoFocus:!0,onChange:t=>{p({...a,[e.name]:t.target.value})},onKeyDown:t=>{if("Enter"===t.key&&(t.shiftKey||t.ctrlKey||t.metaKey)){p({...a,[e.name]:t.currentTarget.value+"\n"});return}if(13===t.which){t.preventDefault(),onSubmit();return}}})})},"".concat(e).concat(t))),(0,l.jsx)("div",{children:(0,l.jsx)(o.z,{type:"submit",variant:"primary",children:"Submit"})})]})},PromptVariablesDialog=e=>{let{promptVariablesFormState:t,setPromptVariablesFormState:n,setInput:r,focusInput:i}=e;return(0,l.jsx)(a.Q,{label:"Prompt Variables",title:null==t?void 0:t.title,isOpen:!!t,closeModal:()=>{n(null)},children:(0,l.jsx)(PromptVariablesForm,{variables:(null==t?void 0:t.variables)||[],replaceInput:e=>{r(t=>t.replace(s.d,(t,n)=>{let l=e[n];return"string"==typeof l?l:t}))},close:()=>{n(null),i()}})})}},85444:function(e,t,n){n.d(t,{G:function(){return PromptsDialog}});var l=n(97458),s=n(56438),a=n(52983),r=n(70781),i=n(66706),o=n(15960),c=n(50606),d=n(68338),u=n(55544),p=n(6604),m=n(61383),h=n(56030),x=n(18854),g=n(1295);let PromptsDialog=e=>{let{setPromptVariablesFormState:t,setInput:n}=e,f=(0,m.LC)(),v="#prompts"===f,[b,j]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),N=(0,u.useTranslations)(),[k,_]=(0,a.useState)(null),A=(0,x.useRouter)(),C=(0,s.a)([v,b],async()=>{let e=await i.h.prompt.find();return(0,o.df)([...e.values()],"desc")},{enabled:v}),z=C.data||[],R=(0,a.useMemo)(()=>z.find(e=>e.id===b),[z,b]),deletePrompt=async e=>{await i.h.prompt.delete(e),C.refetch()},reset=()=>{j(null),w(!1),C.refetch()};return((0,a.useEffect)(()=>{!1===v&&reset()},[v]),null===f)?null:(0,l.jsxs)(h.Q,{isOpen:v,closeModal:()=>{(0,m.gp)(A,"")},title:N("app.prompts"),label:"Prompts",children:[(b||y)&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-3 text-sm",children:(0,l.jsxs)("button",{type:"button",className:"inline-flex items-center gap-1",onClick:reset,children:[(0,l.jsx)("span",{className:"i-tabler-arrow-left"}),(0,l.jsx)("span",{children:N("app.back")})]})}),(0,l.jsx)(d.A,{editingPrompt:R,onClose:reset})]}),!b&&!y&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{children:(0,l.jsx)(c.z,{type:"button",left:(0,l.jsx)("span",{className:"i-tabler-plus mr-1"}),onClick:()=>w(!0),children:(0,l.jsx)("span",{children:N("app.new_prompt")})})}),z.length>0&&(0,l.jsx)("div",{className:"flex flex-col gap-2 mt-2",children:z.map(e=>(0,l.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,l.jsx)("div",{className:"font-bold",children:e.title}),(0,l.jsx)("div",{children:e.description}),(0,l.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-xs",children:[(0,l.jsx)(c.z,{type:"button",onClick:()=>{let l=(0,r.T)(e.content);l.length>0?(n(e.content),t({title:e.title,variables:l})):(n(e.content),setTimeout(()=>{var e;null===(e=document.querySelector(".input-box"))||void 0===e||e.focus()})),(0,m.gp)(A,"")},children:N("app.use_prompt")}),(0,l.jsx)(c.z,{type:"button",onClick:()=>j(e.id),children:(0,l.jsx)("span",{className:"i-tabler-edit"})}),(0,l.jsxs)(g.hg,{isOpen:k===e.id,onOpenChange:t=>_(t?e.id:null),children:[(0,l.jsx)(c.z,{type:"button",className:"text-red-500",children:(0,l.jsx)("span",{className:"i-tabler-trash"})}),(0,l.jsx)(p.Q,{isDanger:!0,onConfirm:async()=>{deletePrompt(e.id),_(null)},title:N("delete_prompt.title"),desc:N("delete_prompt.desc",{prompt_title:e.title})})]})]})]},e.id))})]})]})}},24180:function(e,t,n){n.d(t,{g:function(){return ScrollableFeed}});var l=n(97458),s=n(52983);let ScrollableFeed=class ScrollableFeed extends s.Component{getSnapshotBeforeUpdate(){if(this.wrapperRef.current&&this.bottomRef.current){let{viewableDetectionEpsilon:e}=this.props;return ScrollableFeed.isViewable(this.wrapperRef.current,this.bottomRef.current,e)}return!1}componentDidUpdate(e,t,n){let{forceScroll:l,changeDetectionFilter:s}=this.props,a=s(e,this.props);a&&(l||n)&&this.bottomRef.current&&this.wrapperRef.current&&this.scrollParentToChild(this.wrapperRef.current,this.bottomRef.current)}componentDidMount(){this.bottomRef.current&&this.wrapperRef.current&&this.scrollParentToChild(this.wrapperRef.current,this.bottomRef.current)}scrollParentToChild(e,t){let{viewableDetectionEpsilon:n}=this.props;if(!ScrollableFeed.isViewable(e,t,n)){let n=e.getBoundingClientRect(),l=t.getBoundingClientRect(),s=l.top+e.scrollTop-n.top,{animateScroll:a,onScrollComplete:r}=this.props;a&&(a(e,s),r())}}static isViewable(e,t,n){n=n||0;let l=e.getBoundingClientRect(),s=t.getBoundingClientRect(),a=s.top>=l.top,r=l.top+e.clientHeight-s.top,i=r+n>=0;return a&&i}handleScroll(){let{viewableDetectionEpsilon:e,onScroll:t}=this.props;if(t&&this.bottomRef.current&&this.wrapperRef.current){let n=ScrollableFeed.isViewable(this.wrapperRef.current,this.bottomRef.current,e);t(n)}}scrollToBottom(){this.bottomRef.current&&this.wrapperRef.current&&this.scrollParentToChild(this.wrapperRef.current,this.bottomRef.current)}render(){let{children:e,className:t}=this.props;return(0,l.jsxs)("div",{className:t,ref:this.wrapperRef,onScroll:this.handleScroll,children:[e,(0,l.jsx)("div",{ref:this.bottomRef})]})}constructor(e){super(e),this.bottomRef=(0,s.createRef)(),this.wrapperRef=(0,s.createRef)(),this.handleScroll=this.handleScroll.bind(this)}};ScrollableFeed.defaultProps={forceScroll:!1,animateScroll:(e,t)=>{e.scrollBy?e.scrollBy({top:t}):e.scrollTop=t},onScrollComplete:()=>{},changeDetectionFilter:()=>!0,viewableDetectionEpsilon:2,onScroll:()=>{}}},67843:function(e,t,n){n.d(t,{S:function(){return O}});var l=n(97458),s=n(52983),a=n(1481),r=n(91601),i=n(89691),o=n(14830);function formatDuration(e){let t=Math.floor(e%60);return"".concat(Math.floor(e/60),":").concat(t<10?"0":"").concat(t)}var c=n(56438),d=n(66706),u=n(15960),p=n(68338),m=n(60919),h=n(97827),x=n(70781),g=n(98846),f=n(92891),v=n(33168),b=n(55544),j=n(99562),y=n(16361),w=n(18854),N=n(70433),k=n(61383),_=n(56030),A=n(78164);let Dropzone=e=>{let{filterFiles:t,handleFiles:n}=e,a=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let onDragOver=e=>{e.preventDefault(),e.stopPropagation(),a.current&&(a.current.classList.remove("hidden"),a.current.classList.add("flex"))};return document.addEventListener("dragover",onDragOver),()=>{document.removeEventListener("dragover",onDragOver)}},[t]),(0,l.jsx)(A.h,{children:(0,l.jsx)("div",{ref:a,"aria-hidden":!0,className:"hidden fixed inset-0 z-[9999] bg-blue-700/80 items-center justify-center border-8 border-dashed border-white text-white",onDrop:e=>{var l;e.preventDefault(),e.stopPropagation(),a.current&&(a.current.classList.remove("flex"),a.current.classList.add("hidden"));let s=[...(null===(l=e.dataTransfer)||void 0===l?void 0:l.files)||[]].filter(t);0!==s.length&&n(s)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),a.current&&(a.current.classList.remove("flex"),a.current.classList.add("hidden"))},children:(0,l.jsx)("span",{className:"text-7xl font-bold",children:"Drop files here.."})})})};var C=n(50606),z=n(38660);let SendButton=e=>{let{isResponding:t,stopGenerating:n,submit:s,hasInput:a}=e,{config:r}=(0,v.ZR)(),i=(0,b.useTranslations)();return(0,l.jsxs)(z.u,{delayDuration:500,children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsxs)("button",{type:"button",className:(0,C.d)({className:"group px-2 text-xs rounded-lg bg-zinc-100 dark:bg-zinc-800 h-7 hover:text-black dark:hover:text-white hidden md:inline-flex",variant:"ghost"}),onClick:()=>{t&&!a?n():s()},children:[i(t&&!a?"app.cancel":"app.submit"),(0,l.jsx)("span",{className:"ml-1",children:t?"↵":"commandorctrl_enter"===r.submit_shortcut?"⌘↵":"↵"})]})}),!t&&(0,l.jsx)(z._v,{align:"end",children:i("send.key_to_insert_newline",{key:"commandorctrl_enter"===r.submit_shortcut?"↵":"⌘↵"})})]})};var R=n(19106),S=n(5200),D=n(72686),F=n(73474),M=n.n(F),P=n(72911),E=n(65172);let ShareDialog=e=>{var t,n,r;let{messages:i,chat:c}=e,d=(0,b.useTranslations)(),u=(0,k.LC)(),p=(0,w.useRouter)(),m=(0,s.useRef)(null),h=S.S.share.createShare.useMutation({onError(e){(0,g._)(e)}}),{config:x}=(0,v.ZR)(),f=(0,P.F)(()=>{var e;return(null===(e=m.current)||void 0===e?void 0:e.textContent)||""}),j=(0,P.F)(()=>{var e;return"".concat(E._O,"/s/").concat(null===(e=h.data)||void 0===e?void 0:e.id)}),y=[{label:d("app.plain_text"),id:"plain_text",content:(0,l.jsxs)("div",{className:"bg-zinc-50 dark:bg-zinc-800 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)(C.z,{type:"button",onClick:f.copy,left:(0,l.jsx)("span",{className:(0,o.cn)("mr-1",f.copied?"i-tabler-clipboard-check":"i-tabler-clipboard")}),children:d(f.copied?"app.copied":"app.copy")})}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",ref:m,children:[(0,l.jsxs)("div",{className:"",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Context"}),":"," ",(null===(t=c.context)||void 0===t?void 0:t.url)||""]}),null===(r=c.context)||void 0===r?void 0:null===(n=r.sources)||void 0===n?void 0:n.map((e,t)=>(0,l.jsx)("div",{children:"url"===e.type?e.url:""},t))]}),i.map(e=>(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold",children:e.role}),":"," ",e.content]},e.id))]})]})},{label:d("app.sharable_link.label"),id:"sharable_link",content:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-3",children:d("app.sharable_link.desc")}),h.data&&(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("div",{className:"font-medium",children:d("app.sharable_link.show_once_tip")}),(0,l.jsxs)("div",{className:"flex gap-1 mt-1",children:[(0,l.jsx)(D.I,{readOnly:!0,value:"".concat(E._O,"/s/").concat(h.data.id)}),(0,l.jsx)(C.z,{className:"h-10",type:"button",onClick:j.copy,left:(0,l.jsx)("span",{className:(0,o.cn)("mr-1",j.copied?"i-tabler-clipboard-check":"i-tabler-clipboard")}),children:d(j.copied?"app.copied":"app.copy")})]}),h.data.deleteToken&&(0,l.jsx)("div",{className:"text-sm mt-5",children:d.rich("app.sharable_link.open_url_to_delete",{url:()=>(0,l.jsxs)("a",{target:"_blank",className:"underline text-red-500",href:"".concat(E._O,"/api/delete-share?token=").concat(h.data.deleteToken),children:[E._O,"/api/delete-share?token=",h.data.deleteToken]})})})]}),!h.data&&(0,l.jsx)(C.z,{type:"button",variant:"primary",className:"px-3",isLoading:h.isLoading,onClick:()=>{var e;h.mutate({title:c.title,messages:i.map(e=>({...e,createdAt:M()(e.createdAt).toDate().toISOString()})),context:c.context||{},chatId:c.id,model:c.model,temperature:c.temperature,initialSystemMessage:c.initialSystemMessage,tools:c.tools,plugins:(0,a.R3)(c.model)?null===(e=x.installedPlugins)||void 0===e?void 0:e.filter(e=>e.enabled).map(e=>e.name_for_model):void 0})},children:d("app.sharable_link.create")})]})}];return(0,l.jsx)(_.Q,{title:d("app.share"),label:"Share",closeModal:()=>{(0,k.gp)(p,""),setTimeout(()=>{h.reset()},200)},isOpen:"#share"===u,children:(0,l.jsxs)(R.mQ,{defaultValue:"plain_text",className:"",children:[(0,l.jsx)(R.dr,{className:"sticky top-0 bottom-0",children:y.map(e=>(0,l.jsx)(R.SP,{value:e.id,children:e.label},e.id))}),y.map(e=>(0,l.jsx)(R.nU,{value:e.id,children:e.content},e.id))]})})};var T=n(48452),I=n(81859),U=n(1295),L=n(4124),V=n(33569);let getImageSize=e=>new Promise((t,n)=>{let l=URL.createObjectURL(e),s=new Image;s.onload=()=>{URL.revokeObjectURL(l),t({width:s.width,height:s.height})},s.onerror=n,s.src=l}),PromptListItem=e=>{let{item:t,isActive:n,setShowNewPromptTemplateDialog:a}=e,r=(0,b.useTranslations)(),i=(0,s.useRef)(null),c=(0,o.cn)("px-3 h-8 flex items-center w-full outline-none",n?"bg-zinc-100 dark:bg-zinc-800":"hover:bg-zinc-100 dark:hover:bg-zinc-600");return((0,s.useEffect)(()=>{n&&i.current&&(0,m.Z)(i.current,{scrollMode:"if-needed"})},[n]),"new"===t.type)?(0,l.jsxs)("button",{type:"button",className:c,ref:i,onClick:()=>{a(!0)},children:[(0,l.jsx)("span",{className:"i-tabler-plus mr-1"}),r("app.new_prompt")]}):(0,l.jsx)("button",{type:"button",ref:i,className:c,onClick:t.onClick,children:t.prompt.title})},K=/\/\w*$/,O=(0,s.forwardRef)((e,t)=>{var n;let{chatId:m,send:A,input:R,setInput:S,files:D,setFiles:F,setPromptVariablesFormState:M,showFileUploadButton:P,latestUserMessageContent:E,alwaysUseCredits:O,hasMessages:B,stopGenerating:Z,isResponding:q,hasInput:Q,currentChat:W,displayMessages:H,error:Y,retry:J,saveScreenshot:G,viewScreenshot:X,generateChatTitle:$,generateFollowupQuestions:ee}=e,{config:et}=(0,v.ZR)(),en=(0,s.useRef)(null),el=(0,h.Z)(t,en),es=(0,w.useRouter)(),[,ea]=(0,y.c$)(),er=(0,N.jp)(),ei=(0,k.LC)(),[,eo]=(0,y.co)(),ec=(0,s.useRef)(null),ed=(0,s.useRef)(null),[eu,ep]=(0,s.useState)("idle"),em=(0,s.useRef)(null),eh=(0,s.useRef)(!1),ex="idle"!==eu,[eg,ef]=(0,s.useState)(0),ev=(0,s.useRef)(0),eb=(0,s.useRef)(null),[ej,ey]=(0,s.useState)(!1),[ew,eN]=(0,s.useState)(""),[ek,e_]=(0,s.useState)(!1),[eA,eC]=(0,s.useState)(!1),[ez,eR]=(0,s.useState)(0),eS=(0,b.useTranslations)(),eD=(0,j.n)(),eF=(0,c.a)([ej],async()=>{let e=await d.h.prompt.find({});return(0,u.df)([...e.values()],"desc")},{enabled:ej,refetchOnWindowFocus:!1}),eM=[...eF.data?eF.data.filter(e=>!ew||e.title.toLowerCase().includes(ew.toLowerCase())).map((e,t)=>({type:"prompt",prompt:e,onClick(){selectPrompt(t)}})):[]],eP=eM.length;eM.push({type:"new",onClick(){selectPrompt(eP)}}),(0,s.useEffect)(()=>{let handleClick=e=>{let t=ec.current,n=e.target;t&&n&&!ek&&!t.contains(n)&&ey(!1)};return window.addEventListener("mousedown",handleClick),()=>{window.removeEventListener("mousedown",handleClick)}},[ek]),(0,s.useEffect)(()=>{ej||eR(0)},[ej]),(0,s.useEffect)(()=>{if(em.current)return;let e=null;return em.current=new T.K,em.current.on("record-start",()=>{eh.current=!1,ef(0),ev.current=0,ep("recording"),e=window.setInterval(()=>{ef(e=>e+1),ev.current+=1},1e3)}),em.current.on("record-end",async t=>{if(e&&(window.clearInterval(e),e=null),!eh.current){ep("transcribing"),eb.current=new AbortController;try{let e=new File([t],"audio.wav",{type:t.type}),l=await d.h.config.get();if(l){var n;let t=await (0,a.$$)({file:e,config:l,duration:ev.current,t:eS,alwaysUseCredits:O,signal:null===(n=eb.current)||void 0===n?void 0:n.signal});S(t),eC("select")}}catch(e){eb.current.signal.aborted||(0,g._)(e)}}ep("idle")}),()=>{}},[]);let eE=(0,s.useCallback)(e=>{let t=e.match(/(?:^|[^\/\:])\/(\w*)$/);t?(ey(!0),eN(t[1])):(ey(!1),eN(""))},[]),selectPrompt=e=>{let t=eM[e];if("prompt"===t.type){S(R.replace(K,"")+t.prompt.content),ey(!1);let e=(0,x.T)(t.prompt.content);e.length>0?M({title:t.prompt.title,variables:e}):M(null)}else e_(!0)},uploadFiles=async e=>{await Promise.all(e.map(async e=>{if(e.size>5e6){(0,g._)("".concat(e.name," cannot be bigger than 5MB"));return}let t=i.Am.loading("Uploading ".concat(e.name,"..."));try{let n=await (0,f.c)(e,{mime:e.type,name:e.name,chatId:m}),l=n.url,s=n.id,a=await getImageSize(e);F(t=>[...t,{id:s,name:e.name,url:l,type:"image",width:a.width,height:a.height}]),eC(!0),i.Am.success("Uploaded!",{id:t})}catch(e){(0,g._)(e,t)}}))},eT="commandorctrl_enter"===et.submit_shortcut||(null===(n=eD.data)||void 0===n?void 0:n.isTouch);(0,s.useEffect)(()=>{es.isReady&&!ei&&eC(!0)},[es.query.chat,es.isReady,ei]),(0,s.useEffect)(()=>{if(eA){let e=en.current;e&&(e.focus(),"select"===eA&&e.setSelectionRange(0,e.value.length))}},[eA]);let eI=(0,s.useCallback)(()=>{W&&d.h.message.set({id:(0,L.x0)(),content:"ignore-message",createdAt:new Date,role:"custom:ignore-messages",chatId:W.id})},[null==W?void 0:W.id]);return(0,l.jsxs)(l.Fragment,{children:[P&&(0,l.jsx)(Dropzone,{filterFiles:e=>e.type.startsWith("image/"),handleFiles:e=>{if(!er.data){(0,k.gp)(es,"#pricing");return}uploadFiles(e)}}),(0,l.jsx)(_.Q,{label:"New prompt",title:eS("app.new_prompt"),isOpen:ek,closeModal:()=>{e_(!1),eC(!0)},children:(0,l.jsx)(p.A,{onClose:()=>{e_(!1),eF.refetch()}})}),W&&(0,l.jsx)(ShareDialog,{messages:H,chat:W}),(0,l.jsx)("div",{className:(0,o.cn)("text-sm flex items-center justify-between w-full"),children:(0,l.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,l.jsxs)(z.u,{children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsxs)("button",{type:"button",onClick:()=>{var e,t,n;if(!er.data){(0,k.gp)(es,"#pricing");return}if(ex){if("transcribing"===eu){null===(t=eb.current)||void 0===t||t.abort(),ep("idle");return}null===(e=em.current)||void 0===e||e.stopAll()}else null===(n=em.current)||void 0===n||n.startRecording()},className:(0,C.d)({variant:"ghost",className:"h-8"}),children:["transcribing"===eu?(0,l.jsx)(V.$,{}):(0,l.jsx)("span",{className:(0,o.cn)(ex?"i-tabler-check text-green-500":"i-tabler-microphone")}),"transcribing"===eu&&(0,l.jsx)("span",{className:"ml-2",children:eS("send.transcribing")})]})}),(0,l.jsx)(z._v,{children:"recording"===eu?eS("app.finish"):eS("app_settings.voice_input.label")})]}),"recording"===eu&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(z.u,{children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsx)("button",{type:"button",className:(0,C.d)({variant:"ghost",className:"h-8 text-red-500"}),onClick:()=>{var e;eh.current=!0,null===(e=em.current)||void 0===e||e.stopAll()},children:(0,l.jsx)("span",{className:"i-tabler-x"})})}),(0,l.jsx)(z._v,{children:eS("app.cancel")})]}),(0,l.jsx)("span",{className:"ml-2",children:formatDuration(eg)})]}),P&&!ex&&(0,l.jsxs)(z.u,{children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsx)("button",{type:"button",className:(0,C.d)({variant:"ghost",className:"h-8"}),onClick:()=>{var e;if(!er.data){(0,k.gp)(es,"#pricing");return}null===(e=ed.current)||void 0===e||e.click()},children:(0,l.jsx)("span",{className:"i-mingcute-attachment-line"})})}),(0,l.jsx)(z._v,{children:eS("send.upload_images")})]}),B&&!ex&&(0,l.jsxs)(z.u,{children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsx)("button",{type:"button",className:(0,C.d)({variant:"ghost",className:(0,o.cn)("h-8",q&&"animate-pulse",q||Y?"text-red-500 ":"")}),onClick:()=>{q?Z():J()},children:(0,l.jsx)("span",{className:(0,o.cn)(q?"i-mingcute-stop-circle-fill":Y?"i-tabler-refresh-alert":"i-tabler-refresh")})})}),(0,l.jsx)(z._v,{children:q?eS("app.stop_generating"):eS("app.regenerate")})]}),B&&!ex&&(0,l.jsxs)(z.u,{children:[(0,l.jsx)(z.aJ,{asChild:!0,children:(0,l.jsx)("button",{type:"button",className:(0,C.d)({variant:"ghost",className:"h-8"}),onClick:()=>{(0,k.gp)(es,"#share")},children:(0,l.jsx)("span",{className:"i-tabler-share"})})}),(0,l.jsx)(z._v,{children:eS("app.share")})]}),!ex&&(0,l.jsxs)(U.bF,{children:[(0,l.jsx)(C.z,{className:"h-8",variant:"ghost",children:(0,l.jsx)("span",{className:"i-tabler-dots"})}),(0,l.jsxs)(I.H,{placement:"top",disabledKeys:B?[]:["save-screenshot","view-screenshot","generate-chat-title","generate-followup-questions","ignore-messages","show-delete-messages-modal"],onAction:e=>{"save-screenshot"===e?G():"view-screenshot"===e?null==X||X():"generate-chat-title"===e?$():"generate-followup-questions"===e?ee():"ignore-messages"===e?eI():"show-delete-messages-modal"===e&&eo(!0)},children:[(0,l.jsxs)(I.w,{id:"save-screenshot",children:[(0,l.jsx)("span",{className:"i-tabler-screenshot mr-2"}),(0,l.jsx)("span",{children:eS("app.save_screenshot")})]}),X&&(0,l.jsxs)(I.w,{id:"view-screenshot",children:[(0,l.jsx)("span",{className:"i-tabler-external-link mr-2"}),(0,l.jsx)("span",{children:eS("app.view_screenshot")})]}),(0,l.jsxs)(I.w,{id:"generate-chat-title",children:[(0,l.jsx)("span",{className:"i-tabler-text-recognition mr-2"}),(0,l.jsx)("span",{children:eS("app.generate_chat_title")})]}),(0,l.jsxs)(I.w,{id:"generate-followup-questions",children:[(0,l.jsx)("span",{className:"i-tabler-message-question mr-2"}),(0,l.jsx)("span",{children:eS("app.generate_followup_questions")})]}),(0,l.jsxs)(I.w,{id:"ignore-messages",children:[(0,l.jsx)("span",{className:"i-ic-twotone-insert-page-break mr-2"}),(0,l.jsx)("span",{children:eS("app.ignore_messages.button_label")})]}),(0,l.jsxs)(I.w,{className:"text-red-600",id:"show-delete-messages-modal",children:[(0,l.jsx)("span",{className:"i-tabler-message-x mr-2"}),(0,l.jsx)("span",{children:eS("app.delete_messages")})]})]})]})]})}),(0,l.jsxs)("div",{className:"relative dark:text-zinc-200",children:[ej&&(0,l.jsx)("div",{ref:ec,className:"absolute z-10 -translate-y-full whitespace-nowrap pb-2",children:(0,l.jsx)("div",{className:"max-h-[300px] min-w-[140px] scroll-py-2 overflow-y-auto rounded-xl border bg-white py-2 text-xs shadow-sm dark:bg-zinc-700",children:eM.map((e,t)=>(0,l.jsx)(PromptListItem,{item:e,isActive:t===ez,setShowNewPromptTemplateDialog:e_},"new"===e.type?"new":e.prompt.id))})}),(0,l.jsxs)("div",{className:"flex items-end gap-1 pb-2",children:[(0,l.jsxs)("div",{className:"w-0 grow items-center",children:[D.length>0&&(0,l.jsx)("div",{className:"p-2 px-2 flex gap-2",children:D.map(e=>(0,l.jsxs)("div",{className:"relative inline-block",children:[(0,l.jsx)("div",{className:"w-20 h-20 bg-center bg-cover rounded-xl border",style:{backgroundImage:"url(".concat(e.url,")")}}),(0,l.jsx)("button",{type:"button",className:"absolute top-1 right-1 bg-zinc-500/50 hover:bg-red-500 text-white w-5 h-5 rounded-full",onClick:()=>{F(t=>t.filter(t=>t.id!==e.id))},children:(0,l.jsx)("span",{className:"i-tabler-x"})})]},e.id))}),(0,l.jsxs)("div",{className:"flex items-end",children:[(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(r.Z,{ref:el,onBlur:()=>{eC(!1)},className:(0,o.cn)("input-box min-h-[2.6rem] flex-grow resize-none scroll-p-2 rounded-xl bg-transparent px-2 py-2 outline-none"),placeholder:eS("send.placeholder"),onChange:e=>{S(e.currentTarget.value),eE(e.currentTarget.value)},onFocus:e=>{eE(e.currentTarget.value)},onPaste:async e=>{if(!P)return;let t=[...e.clipboardData.files].filter(e=>e.type.startsWith("image/"));if(t.length>0){if(e.preventDefault(),!er.data){(0,k.gp)(es,"#pricing");return}uploadFiles(t)}},onKeyDown:e=>{if(!Q&&q&&"Enter"===e.key){e.preventDefault(),Z();return}if("ArrowUp"===e.key&&en.current&&!en.current.value&&E){e.preventDefault(),(0,u.BH)(en.current,E);return}if("commandorctrl_enter"!==et.submit_shortcut&&"Enter"===e.key&&(e.ctrlKey||e.metaKey||e.shiftKey)){e.preventDefault(),en.current&&(0,u.BH)(en.current,"\n");return}if("Escape"===e.key&&ej){e.preventDefault(),ey(!1);return}if("ArrowUp"===e.key&&ej&&eM.length>0){e.preventDefault(),eR(e=>0===e?eM.length-1:e-1);return}if("ArrowDown"===e.key&&ej&&eM.length>0){e.preventDefault(),eR(e=>e===eM.length-1?0:e+1);return}if("Enter"===e.key&&ej){e.preventDefault(),selectPrompt(ez);return}eT?"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),A()):13===e.which&&(e.preventDefault(),A())},value:R,maxRows:10})}),(0,l.jsxs)("div",{className:"inline-flex items-center pr-2 h-[2.6rem]",children:[(0,l.jsx)("input",{type:"file",className:"hidden",ref:ed,onChange:e=>{let t=[...e.currentTarget.files||[]];e.target.value="",uploadFiles(t)},accept:"image/png,image/jpeg,image/gif,image/webp"}),(0,l.jsx)(SendButton,{isResponding:q,submit:A,stopGenerating:Z,hasInput:Q})]})]})]}),(0,l.jsx)("div",{className:"flex items-center shrink-0 h-[2.6rem]",children:"recording"!==eu&&(R||D.length>0)&&(0,l.jsx)("button",{type:"button",className:(0,o.cn)("h-8 w-8 hover:bg-zinc-300 rounded-full inline-flex items-center justify-center dark:hover:bg-zinc-700","md:hidden"),onClick:()=>A(),children:(0,l.jsx)("span",{className:"i-tabler-send"})})})]})]})]})})},17576:function(e,t,n){n.d(t,{Z:function(){return SetApiKeyInput}});var l=n(97458),s=n(52983),a=n(60863),r=n(89691),i=n(14830),o=n(66706),c=n(33168),d=n(50606),u=n(72686),p=n(55544),m=n(51758),h=n(61383),x=n(18854);let SetApiKeyInput=e=>{let{className:t,type:n}=e,g=(0,x.useRouter)(),{config:f}=(0,c.ZR)(),v=(0,p.useTranslations)(),{setValue:b,register:j,handleSubmit:y}=(0,a.cI)({defaultValues:{key:""}});return(0,s.useEffect)(()=>{b("key",("pplx"===n?f.pplxKey:"openai"===n?f.openAIKey:"cohere"===n?f.cohereKey:"gemini"===n?f.geminiKey:f.openRouterKey)||"")},[f.pplxKey,f.openAIKey,f.openRouterKey,f.geminiKey,f.cohereKey]),(0,l.jsxs)("form",{onSubmit:y(e=>{o.h.config.update("openai"===n?{openAIKey:e.key}:"pplx"===n?{pplxKey:e.key}:"cohere"===n?{cohereKey:e.key}:"gemini"===n?{geminiKey:e.key}:{openRouterKey:e.key}),r.Am.success("Saved!")}),className:(0,i.cn)("w-full",t),children:[(0,l.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,l.jsx)(u.I,{className:"flex-grow",placeholder:"".concat("pplx"===n?"Perplexity":"openai"===n?"OpenAI":"cohere"===n?"Cohere":"gemini"===n?"Gemini":"OpenRouter"," ").concat(v("app.apiKey")),required:!0,...j("key")}),(0,l.jsx)(d.z,{type:"submit",className:"h-10",children:v("app.save")})]}),(0,l.jsx)("div",{className:"text-sm text-zinc-400 mt-2 text-center",children:"openrouter"===n?v.rich("app.openRouterKeyTip",{link_openrouter:e=>(0,l.jsx)(m.b,{href:"https://openrouter.ai/keys",className:"underline",children:e})}):"pplx"===n?v.rich("app.pplxKeyTip",{link_pplx:e=>(0,l.jsx)("a",{href:"https://www.perplexity.ai/settings",target:"_blank",rel:"noopener nofollow",className:"underline",children:e})}):"cohere"===n?v.rich("app.cohereKeyTip",{link_cohere:e=>(0,l.jsx)("a",{href:"https://cohere.com",target:"_blank",rel:"noopener nofollow",className:"underline",children:e})}):"gemini"===n?v.rich("app.geminiKeyTip",{link_gemini:e=>(0,l.jsx)("a",{href:"https://makersuite.google.com/u/2/app/apikey",target:"_blank",rel:"noopener nofollow",className:"underline",children:e})}):v.rich("app.openaiApiKeyTip",{link_api_key:e=>(0,l.jsx)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noopener nofollow",className:"underline",children:e}),link_credits:e=>(0,l.jsx)("button",{type:"button",onClick:()=>{(0,h.gp)(g,"#pricing")},className:"underline",children:e})})})]})}},19106:function(e,t,n){n.d(t,{SP:function(){return c},dr:function(){return o},mQ:function(){return i},nU:function(){return d}});var l=n(97458),s=n(52983),a=n(38008),r=n(14830);let i=a.fC,o=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,l.jsx)(a.aV,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center rounded-lg bg-zinc-300/50 z-10 backdrop-blur-lg p-1 dark:bg-zinc-800",n),...s})});o.displayName=a.aV.displayName;let c=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,l.jsx)(a.xz,{className:(0,r.cn)("inline-flex min-w-[100px] items-center justify-center px-3 py-1.5  text-sm font-medium rounded-lg text-zinc-700 transition-all  disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-zinc-900 data-[state=active]:shadow-sm dark:text-zinc-200 dark:data-[state=active]:bg-zinc-900 dark:data-[state=active]:text-zinc-100",n),...s,ref:t})});c.displayName=a.xz.displayName;let d=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,l.jsx)(a.VY,{className:(0,r.cn)("mt-2",n),...s,ref:t})});d.displayName=a.VY.displayName},51758:function(e,t,n){n.d(t,{b:function(){return UniLink}});var l=n(97458),s=n(62729),a=n.n(s),r=n(18854);n(85273);var i=n(15960);let UniLink=e=>{let{href:t,shallow:n,className:s,children:o,innerRef:c}=e,d=(0,r.useRouter)(),u="string"==typeof t&&(0,i.Bm)(t);return(0,l.jsx)(a(),{ref:c,href:t,target:u?"_blank":void 0,shallow:n,className:s,...(0,i.DX)(()=>{u&&"string"==typeof t?window.open(t,"_blank"):d.push(t,void 0,{shallow:n})}),children:o})}},36637:function(e,t,n){n.d(t,{C:function(){return VoiceChatDialog}});var l=n(97458),s=n(16361),a=n(52983),r=n(48452),i=n(56030);function VoiceChatDialog(e){let{chatId:t}=e,[n,o]=(0,s.c$)();return(0,a.useEffect)(()=>{if(!n)return;let e=new r.K;return e.on("stop-speaking",e=>{console.log(e)}),e.startRecording(),()=>{e.stopAll()}},[n]),(0,l.jsx)(i.Q,{label:"Voice Chat",isOpen:n,closeModal:()=>{o(!1)},withCloseButton:!1,children:(0,l.jsxs)("div",{className:"h-full flex flex-col",children:[(0,l.jsx)("div",{className:"grow"}),(0,l.jsx)("div",{className:"shrink-0 flex items-center justify-center",children:(0,l.jsx)("button",{type:"button",className:"h-16 w-16 rounded-full inline-flex items-center justify-center bg-red-500 dark:bg-red-600 text-4xl",children:(0,l.jsx)("span",{className:"i-lucide-x"})})})]})})}},81859:function(e,t,n){n.d(t,{H:function(){return UIDropdownMenu},w:function(){return UIDropdownMenuItem}});var l=n(97458);n(52983);var s=n(1295),a=n(14830);let UIDropdownMenu=e=>{let{children:t,className:n,placement:r,...i}=e;return(0,l.jsx)(s.J2,{placement:r,className:(0,a.cn)("animate-in outline-none data-[placement=right]:slide-in-from-left-2 data-[placement=left]:slide-in-from-right-2 data-[placement=bottom]:slide-in-from-top-2 data-[placement=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-xl border border-zinc-200 bg-white p-1 text-zinc-700 shadow-sm dark:shadow-xl dark:border-zinc-700 dark:bg-zinc-800/80 dark:backdrop-blur-lg dark:text-zinc-400",n),children:(0,l.jsx)(s.v2,{className:"outline-none",...i,children:t})})},UIDropdownMenuItem=e=>{let{children:t,id:n,className:r,href:i,target:o}=e;return(0,l.jsx)(s.sN,{id:n,href:i,target:o,className:(0,a.cn)("relative flex cursor-default select-none whitespace-nowrap items-center rounded-lg py-1.5 px-2 text-sm font-medium outline-none focus:bg-zinc-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-zinc-700",r),children:t})}},51129:function(e,t,n){let l;n.d(t,{e:function(){return x}});var s=n(79905),a=n(74550),r=n(1481),i=n(65172),o=n(98846);let c=(0,s.cn)("idle"),d=(0,s.cn)(null),u={current:null},p=(0,s.cn)(1),m=0,h=(0,s.K7)();h.sub(p,()=>{u.current&&(u.current.playbackRate=h.get(p))});let callTTS=async(e,t,n,s)=>{let a=await (0,r.cT)(e,{licenseKey:t,alwaysUseCredits:s});return fetch("".concat(i.T5,"/tts"),{signal:null==l?void 0:l.signal,headers:{...a,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({input:n,type:e.tts_provider||"openai"})})},readLine=async e=>{var t;let{config:n,licenseKey:s,lines:a,alwaysUseCredits:i,t:o}=e,d=a[m];if(!d||(null==l?void 0:l.signal.aborted))return;u.current&&u.current.pause();let p=null===(t=u.current)||void 0===t?void 0:t.playbackRate;u.current=new Audio,h.set(c,"loading");let x=await callTTS(n,s,d,i);if(!x.ok){let e=await x.json(),t=(0,r.Z)(e,{t:o,alwaysUseCredits:i,config:n});throw Error(t)}u.current.addEventListener("canplay",()=>{u.current&&p&&(u.current.playbackRate=p)}),u.current.addEventListener("play",()=>{h.set(c,"playing")}),u.current.addEventListener("ended",()=>{if(m===a.length-1){h.set(c,"idle");return}m++,readLine({config:n,licenseKey:s,lines:a,t:o,alwaysUseCredits:i})}),u.current.src=URL.createObjectURL(await x.blob()),u.current.play();let g=a[m+1];g&&callTTS(n,s,g,i);let f=a[m+2];f&&callTTS(n,s,f,i)},play=async e=>{let{config:t,licenseKey:n,messageId:s,text:a,alwaysUseCredits:r,router:i,t:p}=e;if(!n){i.push({hash:"pricing",pathname:i.pathname,query:i.query});return}let x=h.get(d),g=h.get(c),f="paused"===g&&s===x;if(f){var v;null===(v=u.current)||void 0===v||v.play();return}h.set(d,s);let b=[a];m=0,l&&l.abort(),l=new AbortController,readLine({config:t,licenseKey:n,lines:b,alwaysUseCredits:r,t:p}).catch(e=>{h.set(c,"idle"),m=0,(0,o._)(e)})},pause=()=>{var e;null===(e=u.current)||void 0===e||e.pause(),h.set(c,"paused")},x={statusAtom:c,currentMessageIdAtom:d,audioRef:u,playbackRateAtom:p,play,pause,playPause:e=>{let t=h.get(c),n=h.get(d);"playing"===t||"loading"===t?(pause(),e.messageId!==n&&play(e)):play(e)},stop:()=>{var e;h.set(c,"idle"),null===(e=u.current)||void 0===e||e.pause()},useIsPaused:e=>{let t=(0,a.Dv)(d),n=(0,a.Dv)(c);return t===e&&"paused"===n},useIsPlaying:e=>{let t=(0,a.Dv)(d),n=(0,a.Dv)(c);return t===e&&"playing"===n},useIsLoading:e=>{let t=(0,a.Dv)(d),n=(0,a.Dv)(c);return t===e&&"loading"===n}}},70781:function(e,t,n){n.d(t,{T:function(){return getVariablesFromPrompt},d:function(){return l}});let l=/{{([\w\s\- \u4E00-\u9FFF\u3400-\u4DBF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F\uFF00-\uFFEF]+)(?:\|([\w\s\,\-\u4E00-\u9FFF\u3400-\u4DBF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F\uFF00-\uFFEF]+))?}}/g,getVariablesFromPrompt=e=>{let t=[...e.matchAll(l)].map(e=>{let t=e[1],n=e[2]?e[2].split(","):void 0;return{name:t,values:n}});return t}},48452:function(e,t,n){n.d(t,{K:function(){return Recorder}});let EventEmitter=class EventEmitter{on(e,t){return this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),()=>this.un(e,t)}once(e,t){let n=this.on(e,t),l=this.on(e,()=>{n(),l()});return n}un(e,t){this.listeners[e]&&(t?this.listeners[e].delete(t):delete this.listeners[e])}unAll(){this.listeners={}}emit(e){for(var t=arguments.length,n=Array(t>1?t-1:0),l=1;l<t;l++)n[l-1]=arguments[l];this.listeners[e]&&this.listeners[e].forEach(e=>e(...n))}constructor(){this.listeners={}}};var l=EventEmitter;let s=!1,getMediaRecorder=async(e,t)=>{let[l,a]=await Promise.all([n.e(1858).then(n.bind(n,81858)),n.e(3042).then(n.bind(n,63042))]);if(!s){console.log("register");let e=await a.connect();await l.register(e),s=!0}return new l.MediaRecorder(e,t)};let Recorder=class Recorder extends l{async calculateMicVolume(e){return()=>{}}async startMic(){let e;try{console.log("start mic...");let t=performance.now();e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:this.deviceId},video:!1}),console.log("mic started in",performance.now()-t,"ms")}catch(e){throw Error("Error accessing the microphone: "+e.message)}let t=await this.calculateMicVolume(e);return this.once("destroy",t),this.stream=e,e}stopMic(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null)}async startRecording(){console.log("start recording");let e=this.stream||await this.startMic();console.log("started mic");let t=this.mediaRecorder=await getMediaRecorder(e,{mimeType:"audio/wav"}),n=[],getBlob=()=>new Blob(n,{type:t.mimeType});t.ondataavailable=e=>{n.push(e.data)},t.onstop=()=>{let e=getBlob();this.emit("record-end",e)},t.start(),this.emit("record-start")}isRecording(){var e;return(null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)==="recording"}stopRecording(){if(this.isRecording()){var e;null===(e=this.mediaRecorder)||void 0===e||e.stop()}}stopAll(){this.emit("destroy"),this.stopRecording(),this.stopMic()}constructor(e){super(),this.stream=null,this.mediaRecorder=null,this.deviceId=e}}},16361:function(e,t,n){n.d(t,{c$:function(){return useIsVoiceChat},co:function(){return useShowDeleteMessagesModal}});var l=n(79905),s=n(74550);let a=(0,l.cn)(!1),useShowDeleteMessagesModal=()=>(0,s.KO)(a),r=(0,l.cn)(!1),useIsVoiceChat=()=>(0,s.KO)(r);(0,l.cn)(!1)},29714:function(e,t,n){n.d(t,{j:function(){return tryPersistWithoutPromtingUser}});var l=n(85273);async function tryPersistWithoutPromtingUser(){if(l.lU||navigator.userAgent.includes("Safari"))return;if(!navigator.storage||!navigator.storage.persisted)return"never";let e=await navigator.storage.persisted();if(e)return"persisted";if(!navigator.permissions||!navigator.permissions.query)return"prompt";let t=await navigator.permissions.query({name:"persistent-storage"});if("granted"===t.state){if(e=await navigator.storage.persist())return"persisted";throw Error("Failed to persist")}return"prompt"===t.state?"prompt":"never"}},92891:function(e,t,n){n.d(t,{c:function(){return uploadFile}});var l=n(65172),s=n(80816);async function uploadFile(e,t){let{name:n,mime:a,chatId:r}=t,i={},o=await (0,s.bW)();o&&(i.Authorization="Bearer ".concat(o));let c={name:n,mime:a};r&&(c.chatId=r);let d=await fetch("".concat(l.T5,"/upload?").concat(new URLSearchParams(c).toString()),{body:e,method:"PUT",headers:i}).then(async e=>{if(!e.ok)throw console.log(await e.json()),Error("Failed to upload file");return e.json()});return d}},47394:function(e,t,n){n.d(t,{G:function(){return useMedia}});var l=n(52983);let useMedia=e=>{let[t,n]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let t=window.matchMedia(e),handleChange=()=>{n(t.matches)};return t.addEventListener("change",handleChange),handleChange(),()=>{t.removeEventListener("change",handleChange)}},[e]),t}},76560:function(e,t,n){n.d(t,{b:function(){return useValueChanged}});var l=n(52983);function useValueChanged(e,t){let[n,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!e)return;s(!0);let n=window.setTimeout(()=>{s(!1)},t);return()=>{window.clearTimeout(n)}},[e,t]),n}},74970:function(e,t,n){n.d(t,{f:function(){return useOnWindowFocus}});var l=n(52983);function useOnWindowFocus(e){(0,l.useEffect)(()=>(window.addEventListener("visibilitychange",e,!1),window.addEventListener("focus",e,!1),()=>{window.removeEventListener("visibilitychange",e),window.removeEventListener("focus",e)}),[e])}}}]);
