"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8088],{88088:function(e,t,r){function parse(e,t,r){if(void 0===r&&(r={}),!t.codes){t.codes={};for(var n,i=0;i<t.chars.length;++i)t.codes[t.chars[i]]=i}if(!r.loose&&e.length*t.bits&7)throw SyntaxError("Invalid padding");for(var o=e.length;"="===e[o-1];)if(--o,!r.loose&&!((e.length-o)*t.bits&7))throw SyntaxError("Invalid padding");for(var a=new(null!=(n=r.out)?n:Uint8Array)(o*t.bits/8|0),s=0,c=0,d=0,l=0;l<o;++l){var h=t.codes[e[l]];if(void 0===h)throw SyntaxError("Invalid character "+e[l]);c=c<<t.bits|h,(s+=t.bits)>=8&&(s-=8,a[d++]=255&c>>s)}if(s>=t.bits||255&c<<8-s)throw SyntaxError("Unexpected end of data");return a}function stringify(e,t,r){void 0===r&&(r={});for(var n=r.pad,i=(1<<t.bits)-1,o="",a=0,s=0,c=0;c<e.length;++c)for(s=s<<8|255&e[c],a+=8;a>t.bits;)a-=t.bits,o+=t.chars[i&s>>a];if(a&&(o+=t.chars[i&s<<t.bits-a]),void 0===n||n)for(;o.length*t.bits&7;)o+="=";return o}r.d(t,{encode:function(){return T}});var n={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},i={parse:function(e,t){return parse(e,n,t)},stringify:function(e,t){return stringify(e,n,t)}};let EncoderMap_EncoderMap=class EncoderMap_EncoderMap{[Symbol.toStringTag]="[object EncoderMap]";encoder;constructor(e){this.encoder=new Map(e?Array.from(e,([e,t])=>[e.toString(),t]):void 0)}get size(){return this.encoder.size}clear(){this.encoder.clear()}delete(e){return this.encoder.delete(e.toString())}forEach(e){this.encoder.forEach((t,r)=>{e(t,new Uint8Array(r.split(",").map(Number)),this)})}get(e){return this.encoder.get(e.toString())}getOrThrow(e){let t=this.encoder.get(e.toString());if(void 0===t)throw Error(`The byte-pair encoding does not contain a value for: ${e.toString()}`);return t}has(e){return this.encoder.has(e.toString())}set(e,t){return this.encoder.set(e.toString(),t),this}*entries(){for(let[e,t]of this.encoder.entries())yield[new Uint8Array(e.split(",").map(Number)),t]}*keys(){for(let e of this.encoder.keys())yield new Uint8Array(e.split(",").map(Number))}values(){return this.encoder.values()}[Symbol.iterator](){return this.entries()}};function convertTokenBytePairEncodingFromTuples(e){let t=e.flatMap(([e,t])=>e&&0!==e.length?[[i.parse(e),t]]:[]);return new EncoderMap_EncoderMap(t)}var o=r(34343);function escapeRegExp(e){return e.replace(/[$()*+.?[\\\]^{|}]/g,"\\$&")}let BytePairEncodingCore=class BytePairEncodingCore{encoder;decoder;tokenSplitRegex;specialTokensEncoder;specialTokensDecoder;specialTokenPatternRegex;textEncoder=new TextEncoder;constructor({bytePairEncoder:e,specialTokenEncoder:t,tokenSplitRegex:r}){this.encoder=e??new EncoderMap_EncoderMap,this.decoder=e?new Map([...e].map(([e,t])=>[t,e])):new Map,this.specialTokensEncoder=t??new Map,this.specialTokensDecoder=t?new Map([...t].map(([e,t])=>[t,this.textEncoder.encode(e)])):new Map,this.tokenSplitRegex=r;let n=[...this.specialTokensEncoder.keys()].map(escapeRegExp),i=n.join("|");try{this.specialTokenPatternRegex=new RegExp(i)}catch{throw Error("Invalid regular expression pattern.")}}*encodeNative(e,t){let r=0,n=0;for(;;){let i=this.findNextSpecialStartIndex(e,t,r,this.specialTokenPatternRegex),o=void 0!==i?i:e.length,a=e.slice(r,o-r);for(let[e]of a.matchAll(this.tokenSplitRegex)){let t=this.textEncoder.encode(e),r=this.encoder.get(t);if(void 0!==r){n=1,yield[r];continue}let i=this.bytePairEncode(t,this.encoder);n=i.length,yield i}if(void 0!==i){let t=e.slice(Math.max(0,i)),o=this.specialTokensEncoder.get(t);if(void 0===o)throw Error(`Special token "${t}" is not in the special token encoder.`);yield[o],r=i+t.length,n=0}else break}return n}findNextSpecialStartIndex(e,t,r,n){let i=r;for(;;){let r=n.exec(e.slice(Math.max(0,i)));if(!r)return;let[o]=r;if(t.has(o))return r.index+i;i=r.index+i+1}}*decodeNative(e){for(let t of e){let e=this.tryDecodeToken(t);e&&(yield e)}}async *decodeNativeAsync(e){for await(let t of e){let e=this.tryDecodeToken(t);e&&(yield e)}}tryDecodeToken(e){return this.decoder.get(e)??this.specialTokensDecoder.get(e)}bytePairEncode(e,t){return 1===e.length?[t.getOrThrow(e)]:this.bytePairMerge(e,t,r=>{let n=e.slice(r.start,r.end);return t.getOrThrow(n)})}bytePairMerge(e,t,r){let n=Array.from({length:e.length+1},(e,t)=>({start:t,rank:Number.POSITIVE_INFINITY})),getRank=(r,i)=>{if(r+i+2>=n.length)return;let o=e.slice(n[r].start,n[r+i+2].start);return t.get(o)};for(let e=0;e<n.length-2;e++){let t=getRank(e,0);void 0!==t&&(n[e].rank=t)}for(;n.length>1;){let e=Number.POSITIVE_INFINITY,t=0,r=0;for(let i of n)i.rank<e&&(e=i.rank,t=r),r++;if(e===Number.POSITIVE_INFINITY)break;n[t].rank=getRank(t,1)??Number.POSITIVE_INFINITY,t>0&&(n[t-1].rank=getRank(t-1,1)??Number.POSITIVE_INFINITY),n.splice(t+1,1)}let i=[];for(let e=0;e<n.length-1;e++)i.push(r({start:n[e].start,end:n[e+1].start}));return i}};let a="<|endoftext|>",s="<|fim_prefix|>",c="<|fim_middle|>",d="<|fim_suffix|>",l="<|im_start|>",h="<|im_end|>",p="<|im_sep|>",g="<|endofprompt|>",u="cl100k_base",f="p50k_base",m="p50k_edit",b="r50k_base",y={"gpt-4":u,"gpt-4-32k":u,"gpt-4-0314":u,"gpt-4-32k-0314":u,"gpt-3.5-turbo":u,"gpt-3.5-turbo-0301":u,"text-davinci-003":f,"text-davinci-002":f,"text-davinci-001":b,"text-curie-001":b,"text-babbage-001":b,"text-ada-001":b,davinci:b,curie:b,babbage:b,ada:b,"code-davinci-002":f,"code-davinci-001":f,"code-cushman-002":f,"code-cushman-001":f,"davinci-codex":f,"cushman-codex":f,"text-davinci-edit-001":m,"code-davinci-edit-001":m,"text-embedding-ada-002":u,"text-similarity-davinci-001":b,"text-similarity-curie-001":b,"text-similarity-babbage-001":b,"text-similarity-ada-001":b,"text-search-davinci-doc-001":b,"text-search-curie-doc-001":b,"text-search-babbage-doc-001":b,"text-search-ada-doc-001":b,"code-search-babbage-code-001":b,"code-search-ada-code-001":b},E={"gpt-3.5-turbo":{messageSeparator:"\n",roleSeparator:"\n"},"gpt-3.5-turbo-0301":{messageSeparator:"\n",roleSeparator:"\n"},"gpt-4":{messageSeparator:"",roleSeparator:p},"gpt-4-0314":{messageSeparator:"",roleSeparator:p},"gpt-4-32k":{messageSeparator:"",roleSeparator:p},"gpt-4-32k-0314":{messageSeparator:"",roleSeparator:p}},k=/'s|'t|'re|'ve|'m|'ll|'d| ?\p{L}+| ?\p{N}+| ?[^\s\p{L}\p{N}]+|\s+(?!\S)|\s+/gu;function R50KBase(e){return{expectedVocabularySize:50257,tokenSplitRegex:k,mergeableBytePairRanks:e,specialTokenMapping:new Map([[a,50256]])}}function P50KBase(e){return{expectedVocabularySize:50281,tokenSplitRegex:k,mergeableBytePairRanks:e,specialTokenMapping:new Map([[a,50256]])}}function P50KEdit(e){let t=new Map([[a,50256],[s,50281],[c,50282],[d,50283]]);return{tokenSplitRegex:k,mergeableBytePairRanks:e,specialTokenMapping:t}}function Cl100KBase(e){let t=new Map([[a,100257],[s,100258],[c,100259],[d,100260],[l,100264],[h,100265],[p,100266],[g,100276]]);return{tokenSplitRegex:/(?:'s|'t|'re|'ve|'m|'ll|'d)|[^\r\n\p{L}\p{N}]?\p{L}+|\p{N}{1,3}| ?[^\s\p{L}\p{N}]+[\r\n]*|\s*[\r\n]+|\s+(?!\S)|\s+/giu,mergeableBytePairRanks:e,specialTokenMapping:t}}function getEncodingParams(e,t){let r=t(e);switch(e.toLowerCase()){case"r50k_base":return R50KBase(r);case"p50k_base":return P50KBase(r);case"p50k_edit":return P50KEdit(r);case"cl100k_base":return Cl100KBase(r);default:throw Error(`Unknown encoding name: ${e}`)}}async function getModelParamsAsync(e,t){let r=await t(e);return getEncodingParams(e,()=>r)}function endsWithIncompleteUtfPairSurrogate(e){if(0===e.length)return!1;let t=e.charCodeAt(e.length-1);return t>=55296&&t<=56319}function getMaxValueFromMap(e){let t=0;return e.forEach(e=>{t=Math.max(t,e)}),t}function getSpecialTokenRegex(e){let t=[...e].map(escapeRegExp),r=t.join("|");return RegExp(`(${r})`)}let GptEncoding=class GptEncoding{static EndOfPrompt=g;static EndOfText=a;static FimMiddle=c;static FimPrefix=s;static FimSuffix=d;decoder=new TextDecoder("utf8");modelName;bytePairEncodingCoreProcessor;specialTokenMapping;constructor({tokenSplitRegex:e,mergeableBytePairRanks:t,specialTokenMapping:r,expectedVocabularySize:n,modelName:i}){let o=Math.max(getMaxValueFromMap(t),getMaxValueFromMap(r));if(this.specialTokenMapping=r,void 0!==n){if(t.size+r.size!==n)throw Error("The number of mergeable tokens and special tokens must be equal to explicit_n_vocab.");if(o!==n-1)throw Error("The maximum token value must be equal to explicit_n_vocab - 1.")}this.bytePairEncodingCoreProcessor=new BytePairEncodingCore({bytePairEncoder:t,specialTokenEncoder:r,tokenSplitRegex:e}),this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),this.encodeGenerator=this.encodeGenerator.bind(this),this.decodeGenerator=this.decodeGenerator.bind(this),this.decodeAsyncGenerator=this.decodeAsyncGenerator.bind(this),this.isWithinTokenLimit=this.isWithinTokenLimit.bind(this),this.encodeChat=this.encodeChat.bind(this),this.encodeChatGenerator=this.encodeChatGenerator.bind(this),this.modelName=i}static getEncodingApi(e,t){let r=getEncodingParams(e,t);return new GptEncoding(r)}static getEncodingApiForModel(e,t){let r=y[e],n=getEncodingParams(r,t);return new GptEncoding({...n,modelName:e})}static async getEncodingApiAsync(e,t){let r=await getModelParamsAsync(e,t);return new GptEncoding(r)}static async getEncodingApiForModelAsync(e,t){let r=y[e],n=await getModelParamsAsync(r,t);return new GptEncoding({...n,modelName:e})}encodeGenerator(e,{allowedSpecial:t=new Set,disallowedSpecial:r=new Set(["all"])}={}){let n=new Set(this.specialTokenMapping.keys());if(r.has("all")&&(r=new Set(n),t.forEach(e=>r.delete(e)),r.forEach(e=>t.delete(e))),t.has("all")&&(t=n),r.size>0){let t=getSpecialTokenRegex(r),n=e.match(t);if(null!==n)throw Error(`Disallowed special token found: ${n[0]}`)}return this.bytePairEncodingCoreProcessor.encodeNative(e,t)}encode(e,t={}){return[...this.encodeGenerator(e,t)].flat()}*encodeChatGenerator(e,t=this.modelName){if(!t)throw Error("Model name must be provided either during initialization or passed in to the method.");let r=E[t],n=this.specialTokenMapping.get(l),i=this.specialTokenMapping.get(h);if(!r||void 0===n||void 0===i)throw Error(`Model '${t}' does not support chat.`);let o=new Set([p]),{messageSeparator:a,roleSeparator:s}=r,c=a.length>0?this.encode(a):[],d=s.length>0?this.encode(s,{allowedSpecial:o}):[],g=new Map;for(let{role:t="system",name:r=t,content:o}of e){if(void 0===o)throw Error("Content must be defined for all messages.");yield[n];let e=g.get(r)??this.encode(r);g.set(r,e),yield e,d.length>0&&(yield d),yield*this.encodeGenerator(o),yield[i],yield c}yield[n],yield*this.encodeGenerator("assistant"),d.length>0&&(yield d)}encodeChat(e,t=this.modelName){return[...this.encodeChatGenerator(e,t)].flat()}isWithinTokenLimit(e,t){let r="string"==typeof e?this.encodeGenerator(e):this.encodeChatGenerator(e),n=0;for(let e of r)if((n+=e.length)>t)return!1;return n}*decodeGenerator(e){let t=this.bytePairEncodingCoreProcessor.decodeNative(e),r="";for(let e of t)0===(r+=this.decoder.decode(e,{stream:!0})).length||endsWithIncompleteUtfPairSurrogate(r)||(yield r,r="");r.length>0&&(yield r)}async *decodeAsyncGenerator(e){let t=this.bytePairEncodingCoreProcessor.decodeNativeAsync(e),r="";for await(let e of t)0===(r+=this.decoder.decode(e,{stream:!0})).length||endsWithIncompleteUtfPairSurrogate(r)||(yield r,r="");r.length>0&&(yield r)}decode(e){return[...this.decodeGenerator(e)].join("")}};let x=GptEncoding.getEncodingApi("cl100k_base",()=>convertTokenBytePairEncodingFromTuples(o.Z)),{decode:w,decodeAsyncGenerator:S,decodeGenerator:v,encode:T,encodeGenerator:M,isWithinTokenLimit:P,encodeChat:N,encodeChatGenerator:I}=x}}]);
